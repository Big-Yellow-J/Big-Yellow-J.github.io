---
layout: mypost
title: Pythonè¿›é˜¶çŸ¥è¯†ï¼šå¤šè¿›ç¨‹/å¤šçº¿ç¨‹/è£…é¥°å™¨
categories: ç¼–ç¨‹
extMath: true
images: true
address: changsha
show_footer_image: true
description: ä¸»è¦ä»‹ç»Pythonè¿›é˜¶çŸ¥è¯†ï¼šå¤šçº¿ç¨‹/å¤šè¿›ç¨‹/è£…é¥°å™¨ä»¥åŠå…·ä½“ä»£ç 
tags: [python, å¤šè¿›ç¨‹, å¤šçº¿ç¨‹, è£…é¥°å™¨]
---

æœ¬æ–‡å†™ä½œäº2025.3.20ï¼Œæ°å¥½ä½œè€…æ­£å¥½åœ¨å¤–é¢å®ä¹ ï¼Œäºæ­¤åŒæ—¶åœ¨å®é™…å·¥ä½œä¸­é‡åˆ°è¿™äº›çŸ¥è¯†ç‚¹ï¼Œå› æ­¤å°±è¿›è¡Œä¸€ä¸ªç®€çŸ­æ±‡æ€»æ–¹ä¾¿åç»­å›é¡¾ï¼Œå¯ä»¥ç›´æ¥çœ‹[ç¬¬ä¸‰èŠ‚](#3å¦‚ä½•åœ¨ä»£ç ä¸­ä½¿ç”¨å¤šè¿›ç¨‹å¤šçº¿ç¨‹è£…é¥°å™¨)

## 1ã€ç®€çŸ­ç†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯å¤šè¿›ç¨‹/å¤šçº¿ç¨‹/è£…é¥°å™¨å’Œä¸€äº›åŸºæœ¬æ¦‚å¿µ

**å¤šè¿›ç¨‹**ï¼šæŒ‡åœ¨åŒä¸€ä¸ªç¨‹åºä¸­åŒæ—¶è¿è¡Œå¤šä¸ªç‹¬ç«‹çš„è¿›ç¨‹ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´å’Œèµ„æºï¼Œäº’ä¸å¹²æ‰°ã€‚å¸¸ç”¨åœ¨CPUå¯†é›†å‹ä»»åŠ¡ä¸­ã€‚
æ¯”å¦‚è¯´ï¼šæ¯”å¦‚ä½ æ‰“å¼€äº†å¤šä¸ªæµè§ˆå™¨çª—å£ï¼Œæ¯ä¸ªçª—å£å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œäº’ä¸å½±å“ã€‚å³ä½¿ä¸€ä¸ªçª—å£å´©æºƒï¼Œå…¶ä»–çª—å£ä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚
**å¤šçº¿ç¨‹**ï¼šæŒ‡åœ¨åŒä¸€ä¸ªè¿›ç¨‹å†…åŒæ—¶è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€å—å†…å­˜ç©ºé—´ã€‚é€‚åˆ**I/Oå¯†é›†å‹ä»»åŠ¡**ï¼ˆä¸»è¦æ¶‰åŠåˆ°è¾“å…¥è¾“å‡ºæ“ä½œçš„ä»»åŠ¡ã€‚è¿™äº›ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ä¸»è¦èŠ±è´¹åœ¨ç­‰å¾…IOæ“ä½œçš„å®Œæˆä¸Šï¼‰ï¼Œçº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢æ¯”è¿›ç¨‹æ›´è½»ä¾¿ã€‚
æ¯”å¦‚è¯´ï¼šä½ åœ¨çœ‹è§†é¢‘çš„åŒæ—¶ï¼Œåå°ä¹Ÿåœ¨ä¸‹è½½æ–‡ä»¶ã€‚è¿™äº›æ“ä½œéƒ½æ˜¯é€šè¿‡ä¸åŒçš„çº¿ç¨‹å®Œæˆçš„ï¼Œè§†é¢‘æ’­æ”¾å’Œä¸‹è½½äº’ä¸å¹²æ‰°ã€‚
**è£…é¥°å™¨**ï¼šä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œèƒ½åœ¨ä¸ä¿®æ”¹åŸå‡½æ•°ä»£ç çš„æƒ…å†µä¸‹ï¼Œç»™å‡½æ•°æ·»åŠ é¢å¤–çš„åŠŸèƒ½ã€‚
æ¯”å¦‚è¯´ï¼šåœ¨ä¸€ä¸ªå‡½æ•°å‰åè‡ªåŠ¨è®°å½•æ‰§è¡Œæ—¶é—´æˆ–æ—¥å¿—ï¼Œå¸¸ç”¨ @decorator_name è¯­æ³•
**å…¨å±€è§£é‡Šå™¨é”**ï¼ˆGILï¼‰ï¼šå®ƒä½¿å¾—ä»»ä½•æ—¶åˆ»ä»…æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œã€‚å³ä¾¿åœ¨å¤šæ ¸å¿ƒå¤„ç†å™¨ä¸Šï¼Œä½¿ç”¨ GIL çš„è§£é‡Šå™¨ä¹Ÿåªå…è®¸åŒä¸€æ—¶é—´æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹ã€‚å¸¸è§çš„ä½¿ç”¨ GIL çš„è§£é‡Šå™¨æœ‰CPythonä¸Ruby MRIã€‚

## 2ã€åœ¨å®é™…ä»»åŠ¡ä¸­ä½¿ç”¨å¤šè¿›ç¨‹/å¤šçº¿ç¨‹

å‡è®¾æœ‰ä¸€ä¸ªä»»åŠ¡æ˜¯å°†8000000ä¸ªæ•°å­—1ç›¸åŠ ï¼Œæˆ‘ä»¬æå‰å‡è®¾æˆ‘ä»¬å·²ç»æ„å»ºå¥½äº†è¿™æ ·ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶ä¸”æˆ‘ä»¬éœ€è¦è®°å½•ä¸€ä¸‹ä»£ç è¿è¡Œéœ€è¦çš„æ—¶é—´ï¼Œæ™®é€šå¤„ç†æ€è·¯ï¼š

```
start_time = time.time()
sum_num = 0
for i in num_list:
    sum_num += i
print(f"Used Time:{time.time()- start_time}")
```

éœ€è¦æ—¶é—´ï¼š`Used Time:0.9650969505310059`ï¼Œé‚£ä¹ˆæœ‰ä¸€ä¸ªæ€è·¯æˆ‘å…ˆå»æŠŠnum_listæ‹†åˆ†ä¸º8ä»½ï¼ˆå› ä¸ºæ•°å­—ç›¸åŠ å¹¶ä¸ä¼šå†²çªï¼Œç”¨åˆ†å—çŸ¥è¯†è§£å†³ï¼‰ç„¶åè®¡ç®—æ—¶é—´ `Used Time:0.07107281684875488`ï¼Œä½†æ˜¯è¿™æ ·æ•°æ®è®¡ç®—æ˜¯ä¸²è¡Œçš„ï¼ˆæ‰§è¡Œå®Œç¬¬ä¸€å—ï¼Œç„¶åå»è®¡ç®—ç¬¬äºŒå—ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è€ƒè™‘å¤šçº¿ç¨‹ç›´æ¥8å—ä¸€èµ·è®¡ç®—ç„¶åå°†æœ€åç»“æœæ±‡æ€»èµ·æ¥ï¼Œè¿™æ ·å¾—åˆ°çš„æ—¶é—´ä¸ºï¼š`Used Time:0.09244751930236816`ï¼Œäºæ­¤åŒæ—¶ä½¿ç”¨å¤šè¿›ç¨‹è®¡ç®—å¾—åˆ°ç»“æœï¼š`Used Time:0.854262113571167`ã€‚è¿™æ ·å°±ä¼šåˆä¸€ä¸ªæœ‰æ„æ€ç°è±¡ï¼Œç†è®ºä¸Šæ¥è¯´å¤šè¿›ç¨‹ï¼Œå¤šçº¿ç¨‹é€Ÿåº¦åº”è¯¥æ˜¯éƒ½å¤§äºå¸¸è§„çš„åˆ†å‰²æ³•ï¼Œå‡ºç°è¿™ä¸ªåŸå› æ˜¯å› ä¸ºï¼š

1. **GILï¼ˆå…¨å±€è§£é‡Šå™¨é”ï¼‰å½±å“**  
- Python çš„ `ThreadPoolExecutor` å— **GIL é™åˆ¶**ï¼Œå¤šä¸ªçº¿ç¨‹å¹¶ä¸ä¼šçœŸæ­£å¹¶è¡Œæ‰§è¡Œï¼Œè€Œæ˜¯**äº¤æ›¿è¿è¡Œ**ï¼Œå› æ­¤å®ƒæ¯”å•çº¿ç¨‹å¿«ï¼Œä½† **æå‡æœ‰é™**ã€‚
- ç”±äº `sum` è®¡ç®—æ˜¯ **CPU å¯†é›†å‹ä»»åŠ¡**ï¼Œçº¿ç¨‹æ± æ— æ³•å……åˆ†å‘æŒ¥ CPU å¤šæ ¸ä¼˜åŠ¿ï¼Œå¯¼è‡´æ€§èƒ½ **ä¸å¦‚ä¸²è¡Œåˆ†å—è®¡ç®—**ã€‚

2. **è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰å¼€é”€**  
- `ProcessPoolExecutor` ä¼š **ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ›å»ºç‹¬ç«‹çš„ Python è§£é‡Šå™¨**ï¼Œæ•°æ®éœ€è¦ **åœ¨ä¸»è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´ä¼ è¾“**ï¼Œä½† `num_list` éå¸¸å¤§ï¼Œå¯¼è‡´ **æ•°æ®ä¼ è¾“å’Œè¿›ç¨‹è°ƒåº¦æˆæœ¬è¿‡é«˜**ï¼Œåè€Œå½±å“æ€§èƒ½ã€‚

3. **ä»»åŠ¡æ‹†åˆ†çš„é¢å¤–å¼€é”€**  
- ç”±äº `sum` æ“ä½œæœ¬èº«éå¸¸ç®€å•ï¼Œè®¡ç®—æ—¶é—´çŸ­ï¼Œçº¿ç¨‹æ± å’Œè¿›ç¨‹æ± çš„ **ç®¡ç†å¼€é”€**ï¼ˆçº¿ç¨‹/è¿›ç¨‹åˆ›å»ºã€è°ƒåº¦ã€å›æ”¶ï¼‰å¯èƒ½è¶…è¿‡è®¡ç®—æœ¬èº«çš„æˆæœ¬ï¼Œå¯¼è‡´æ•´ä½“è¿è¡Œæ—¶é—´åè€Œå˜é•¿ã€‚

ç”¨äººè¯æ¥è¯´å°±æ˜¯ï¼Œä½¿ç”¨å¤šè¿›ç¨‹ï¼Œå°±éœ€è¦è€ƒè™‘åˆ°é€šä¿¡çš„èŠ±é”€ï¼Œç”¨å¤šçº¿ç¨‹å°±è¦è€ƒè™‘åˆ° **GIL**é™åˆ¶ï¼Œæ¢è¨€ä¹‹å¾—åˆ°çš„**ç»“è®ºå°±æ˜¯**ï¼š
- **å¤šçº¿ç¨‹ï¼ˆThreadPoolExecutorï¼‰** é€‚ç”¨äº **I/O å¯†é›†å‹ä»»åŠ¡**ï¼ˆå¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œè¯·æ±‚ï¼‰ï¼Œä½† **CPU è®¡ç®—ä»»åŠ¡å— GIL é™åˆ¶**ï¼Œæå‡æœ‰é™ã€‚
- **å¤šè¿›ç¨‹ï¼ˆProcessPoolExecutorï¼‰** é€‚ç”¨äº **CPU å¯†é›†å‹ä»»åŠ¡**ï¼Œä½†æ•°æ®ä¼ è¾“å¼€é”€å¤§ï¼Œå¯¹ **çŸ­æ—¶é—´è®¡ç®—ä»»åŠ¡** å¯èƒ½ä¸é€‚ç”¨ã€‚

## 3ã€å¦‚ä½•åœ¨ä»£ç ä¸­ä½¿ç”¨å¤šè¿›ç¨‹/å¤šçº¿ç¨‹/è£…é¥°å™¨

* **1ã€å¤šçº¿ç¨‹ä½¿ç”¨**

å¤šçº¿ç¨‹ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œä»¥ä¸‹é¢ä¾‹å­ä¸ºä¾‹ï¼š

```python
from concurrent.futures import ThreadPoolExecutor
with ThreadPoolExecutor(max_workers= n) as executor:
    futures = [executor.submit(sum, chunk) for chunk in chunks]  # æäº¤ä»»åŠ¡
    results = [future.result() for future in as_completed(futures)]  # è·å–ç»“æœ
```

å½“è½¯è¿˜æœ‰å¦å¤–ä¸€ç§æ‰§è¡Œæ–¹å¼ï¼š

```python
import threading
thread_1 = threading.Thread(target= sum)
thread_2 = threading.Thread(target= sum)

thread_1.start()
thread_2.start()

thread_1.join()
thread_2.join()

```

ç¬¬ä¸€ç§ç›¸å¯¹è€Œè¨€æ¯”è¾ƒç®€å•ï¼ˆè‡ªåŠ¨ç®¡ç†çº¿ç¨‹ï¼‰ï¼Œè€Œç¬¬äºŒç§éœ€è¦æˆ‘å»åˆ›å»ºå¤šä¸ªè¿›ç¨‹ï¼Œç„¶åå¯¹ä¸åŒè¿›ç¨‹ä¹‹é—´è¿›è¡Œ `start()` ä»¥åŠ `join()`ï¼Œå®é™…ä½¿ç”¨å¦‚æœæ˜¯ä¸€ä¸ªé•¿æœŸæ‰§è¡Œä»»åŠ¡å¯ä»¥ç”¨ `threading.Thread`ï¼ˆæ¯”å¦‚è¯´è¦ä¸€è‡´ä¿æŒæ‘„åƒå¤´å¼€å¯å°±å¯ä»¥ç›´æ¥ `threading.Thread(target=video_capture_thread, daemon=True).start()` ï¼‰è€Œå¹¶è¡Œä»»åŠ¡å¯ä»¥é€‰æ‹© `ThreadPoolExecutor`ä¸ç”¨å»æ‰‹åŠ¨åˆ›å»º

ä¸€èˆ¬æ¥è¯´ä½¿ç”¨è¿‡ç¨‹ä¸­åªéœ€è¦æ³¨æ„å¦‚ä¸‹å‡ ä¸ªæ“ä½œï¼š1ã€å‘ä½ åˆ›å»ºçš„è¿›ç¨‹ä¸­æäº¤ä»»åŠ¡ï¼ˆæäº¤çš„å†…å®¹æ˜¯ï¼šä½ è¦è¿›è¡Œè®¡ç®—çš„å‡½æ•°ï¼Œå‡½æ•°æ‰€éœ€è¦çš„å‚æ•°ï¼‰ï¼›2ã€è·å–ä½ æäº¤ä»»åŠ¡æ‰€å¾—åˆ°çš„ç»“æœï¼ˆå› ä¸ºæ˜¯å¤šçº¿ç¨‹ï¼Œå› æ­¤è¿”å›å¾—åˆ°çš„ç»“æœä¹Ÿå°±æ˜¯ä¸åŒçº¿ç¨‹çš„ç»“æœï¼‰
éœ€è¦æ³¨æ„çš„å°±æ˜¯ä¸‹é¢å‡ ä¸ªå†…å®¹ï¼š1ã€`submit` æäº¤ä½ çš„ä»»åŠ¡ï¼›2ã€`as_completed` æ‰§è¡Œä½ çš„ä»»åŠ¡
**ä¸è¿‡éœ€è¦å°å¿ƒçš„ä¸€ç‚¹æ˜¯**ï¼Œä½¿ç”¨å¤šçº¿ç¨‹ï¼Œéœ€è¦ä¿è¯ thread-safeï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ï¼Œæ¯”å¦‚è¯´åŒæ—¶å‘ä¸€ä¸ªæ–‡ä»¶é‡Œé¢å†™å…¥æ—¶å€™ï¼Œæˆ‘é€šè¿‡ä½¿ç”¨LLMçš„apiæ‰§è¡Œæ—¶å€™ï¼Œæˆ‘æœ‰ä¸€ä¸ªè¾ƒé•¿çš„æ–‡æœ¬ï¼Œå…ˆå°†ä»–æ‹†åˆ†ï¼ˆä¿è¯æ˜¯æ¨¡å‹çš„æœ€å¤§å…è®¸è¾“å…¥ï¼‰ï¼Œç„¶åâ€œä¸€æ¬¡æ€§â€ï¼ˆå‡è®¾çš„æ˜¯çº¿ç¨‹æ•°é‡æ°å¥½å’Œåˆ†å‰²æ•°é‡ä¸€è‡´ï¼‰å°†å…¶è¿›è¡Œapiè®¿é—®ï¼ˆè¿™æ ·æ—¶é—´æ¶ˆè€—è‚¯å®šæ¯”æ™®é€šçš„è¦å°‘ï¼‰å°†å¤„ç†ç»“æœç„¶åå†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­å°±éœ€è¦è€ƒè™‘è¿›ç¨‹é”é—®é¢˜ï¼Œå› ä¸ºæ‰€æœ‰ä»»åŠ¡ç»“æœéƒ½å†™å…¥åŒä¸€ä¸ªé—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ **è¿›ç¨‹å†²çª**ï¼Œæ¯”å¦‚è¯´ï¼š

```python
from concurrent.futures import ThreadPoolExecutor
import time

def llm_api_result(num):
    time.sleep(2)
    return f"{num}"*100

def write_to_file(num):
    content = f"Thread-{num}: " + llm_api_result(num)
    with open("./output-without-lock.txt", "a", encoding= "utf-8") as f:
        f.write(content)
        f.write("\n")

def main():
    with ThreadPoolExecutor(max_workers=5) as executor:
        futures = [executor.submit(write_to_file, num) for num in range(10)]
        for future in futures:
            future.result()

if __name__ == "__main__":
    start_time = time.time()
    main()
    print("Used Time:", time.time()- start_time)
```

è¿™æ ·ä¸€æ¥å¾—åˆ°çš„ç»“æœä¸ºï¼š

![](https://s2.loli.net/2025/03/24/MNp1SjxQmhFbEnW.png)

ä½†æ˜¯ä¸Šé¢ä»£ç ä¸­å¹¶æ²¡æœ‰å¯¹è¿›ç¨‹åŠ é”ï¼ˆ`lock = threading.Lock()`ï¼‰ï¼Œä½†æ˜¯ç»“æœè¿˜æ˜¯å¯ä»¥æ­£å¸¸ï¼ˆ`write`æ˜¯ä¸€ä¸ª **åŸå­æ“ä½œ** ï¼‰å†™å…¥ï¼ˆæœ‰æ—¶å€™ä¼šå‡ºç°é—æ¼æ‰å†…å®¹ï¼‰ï¼Œä½†æ˜¯å†™å…¥é¡ºåºæ˜¯ä¸å¯¹çš„ã€‚

> **åŸå­æ“ä½œ**ï¼ˆatomic operationï¼‰ æŒ‡çš„æ˜¯ ä¸å¯è¢«ä¸­æ–­çš„æ“ä½œï¼Œå®ƒè¦ä¹ˆ å®Œæ•´æ‰§è¡Œï¼Œè¦ä¹ˆ å®Œå…¨ä¸æ‰§è¡Œ

å°†ä»£ç æ”¹ä¸ºä¸‹é¢ä»£ç ï¼Œé€šè¿‡ä½¿ç”¨è¿›ç¨‹é”æ¥ä¿æŠ¤**åŸå­æ“ä½œ**ï¼š

```python
import threading
lock = threading.Lock()
def write_to_file(num):
    content = f"Thread-{num}: " + llm_api_result(num)
    with lock:
        with open("output-with-lock.txt", "a", encoding="utf-8") as f:
            f.write(content)
            f.write("\n")
```

![](https://s2.loli.net/2025/03/24/LB2i35sGSK9EDXu.png)

è¿™æ ·ä¸€æ¥å°±å¯ä»¥æ­£å¸¸å†™å…¥ç»“æœ

* **2ã€å¤šè¿›ç¨‹ä½¿ç”¨**

Python çš„ multiprocessing æ¨¡å—åŸºäº fork æˆ– spawn æœºåˆ¶ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªç‹¬ç«‹è¿›ç¨‹ï¼Œè®©å®ƒä»¬å¹¶è¡Œæ‰§è¡Œä»»åŠ¡ï¼Œä»è€Œç»•è¿‡**GILï¼ˆå…¨å±€è§£é‡Šå™¨é”ï¼‰**ï¼Œæé«˜ CPU å¯†é›†å‹ä»»åŠ¡çš„æ€§èƒ½ï¼ˆæ•°å­¦è¿ç®—ã€æ•°æ®å¤„ç†ç­‰ï¼‰ã€‚ä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•

ä¸€ä¸ªå…·ä½“ä¾‹å­ï¼š

```python
import time
import multiprocessing
from concurrent.futures import ProcessPoolExecutor, ThreadPoolExecutor

# è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—çš„å‡½æ•°
def fibonacci(n):
    if n <= 1:
        return n
    else:
        return fibonacci(n - 1) + fibonacci(n - 2)

def single_process():
    start_time = time.time()
    for _ in range(4):
        fibonacci(35)
    end_time = time.time()
    print(f"Single-process time: {end_time - start_time:.2f} seconds")

def multi_thread():
    start_time = time.time()
    with ThreadPoolExecutor(max_workers= 4) as executor:
        futures = [executor.submit(fibonacci, 35) for _ in range(4)]
        result = [future.result() for future in futures]
    end_time = time.time()
    print(f"Multi-thread time: {end_time - start_time:.2f} seconds")

def multi_process1():
    start_time = time.time()
    processes = []
    for _ in range(4):
        process = multiprocessing.Process(target=fibonacci, args=(35,))
        processes.append(process)
        process.start()
    for process in processes:
        process.join()
    end_time = time.time()
    print(f"Multi-process-1 time: {end_time - start_time:.2f} seconds")

def multi_process2():
    start_time = time.time()
    with ProcessPoolExecutor(max_workers= 4) as executor:
        futures = [executor.submit(fibonacci, 35) for _ in range(4)]
        result = [future.result() for future in futures]
    end_time = time.time()
    print(f"Multi-process-2 time: {end_time - start_time:.2f} seconds")

if __name__ == "__main__":
    single_process()
    multi_thread()
    multi_process1()
    multi_process2()

Single-process time: 8.93 seconds
Multi-thread time: 9.89 seconds
Multi-process-1 time: 3.81 seconds
Multi-process-2 time: 3.67 seconds
```

pythoné‡Œé¢ä½¿ç”¨å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹ä»£ç ä¸Šæ²¡æœ‰å¤šå¤§åŒºåˆ«ï¼Œåªä¸è¿‡ä½¿ç”¨å¤šè¿›ç¨‹éœ€è¦æ³¨æ„çš„æ˜¯ä¸Šé¢ä»£ç ä½¿ç”¨å¿…é¡»ï¼ˆåœ¨windowç³»ç»Ÿä¸Šï¼‰è¦ç”¨åˆ°ä¸‹é¢ä»£ç ï¼Œä½†æ˜¯linuxç³»ç»Ÿå°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œè¿™æ˜¯å› ä¸º[ä¸¤ç§å¯åŠ¨è¿›ç¨‹çš„æ–¹å¼æ˜¯ä¸åŒçš„](https://docs.python.org/zh-cn/3.13/library/multiprocessing.html#multiprocessing-programming:~:text=%E6%A0%B9%E6%8D%AE%E4%B8%8D%E5%90%8C%E7%9A%84%E5%B9%B3%E5%8F%B0%EF%BC%8C%20multiprocessing%20%E6%94%AF%E6%8C%81%E4%B8%89%E7%A7%8D%E5%90%AF%E5%8A%A8%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%96%B9%E6%B3%95)ã€‚

```python
if __name__ == "__main__":
```

è¿™æ˜¯å› ä¸ºåˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œä¼šé‡æ–°å¯¼å…¥ä¸»æ¨¡å—ã€‚å¦‚æœä¸å°†å¤šè¿›ç¨‹ä»£ç æ”¾åœ¨ `if __name__ == "__main__":` å—ä¸­ï¼Œå¯èƒ½ä¼šå¯¼è‡´é€’å½’åˆ›å»ºå­è¿›ç¨‹ï¼Œç”šè‡³å¼•å‘ç¨‹åºå´©æºƒã€‚æ›´åŠ åº•å±‚çš„åŸå› å¯ä»¥ç›´æ¥å‚è€ƒpython[å®˜æ–¹è§£é‡Š](https://docs.python.org/zh-cn/3.13/library/multiprocessing.html)ã€‚æ›´åŠ è¿›ä¸€æ­¥çš„ç†è§£ python**å¤šè¿›ç¨‹**

**é¦–å…ˆ**åœ¨ Python çš„å¤šè¿›ç¨‹ç¼–ç¨‹ä¸­ï¼Œè¿›ç¨‹ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå®ƒä»¬ä¸èƒ½ç›´æ¥å…±äº«å†…å­˜ã€‚ä¸ºäº†åœ¨ä¸åŒçš„è¿›ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œé€šå¸¸éœ€è¦å°†æ•°æ®åºåˆ—åŒ–ä¸ºå­—èŠ‚æµï¼Œç„¶ååœ¨ç›®æ ‡è¿›ç¨‹ä¸­ååºåˆ—åŒ–ã€‚pickleï¼ˆæ›´åŠ è¯¦ç»†æè¿°[ğŸ”—](https://docs.python.org/zh-cn/3.12/library/pickle.html)ï¼‰ å°±æ˜¯ç”¨æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡çš„ï¼Œè¨€å¤–ä¹‹æ„å°±æ˜¯è¯´éœ€è¦é€šè¿‡ pickle æ¥å°†ä¸åŒè¿›ç¨‹ä¹‹é—´è¿›è¡Œä¼ é€’æ•°æ®ã€‚æ¯”å¦‚è¯´ï¼š

```python
import multiprocessing

def square(number):
    return number â€‹** 2

if __name__ == "__main__":
    numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    # åˆ›å»ºä¸€ä¸ªè¿›ç¨‹æ± ï¼Œä½¿ç”¨ 4 ä¸ªå­è¿›ç¨‹
    with multiprocessing.Pool(processes=4) as pool:
        # ä½¿ç”¨ map æ–¹æ³•å°† square å‡½æ•°åº”ç”¨åˆ° numbers åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ 
        # map æ–¹æ³•ä¼šå°†ä»»åŠ¡åˆ†é…ç»™å­è¿›ç¨‹å¹¶è¡Œæ‰§è¡Œ
        results = pool.map(square, numbers)
    print("åŸå§‹åˆ—è¡¨:", numbers)
    print("å¹³æ–¹ç»“æœ:", results)
```

ä¸Šé¢ä¾‹å­ä¸­ **pickle**ï¼ˆmultiprocessing æ¨¡å—ä¼šè‡ªåŠ¨ä½¿ç”¨ pickle æ¥**åºåˆ—åŒ–**ï¼ˆ**ä¸€èˆ¬è€Œè¨€**ï¼šåŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆ—è¡¨ï¼Œå…ƒç»„ï¼Œå­—å…¸ç­‰å®¹å™¨ç±»å‹ï¼Œè‡ªå®šä¹‰ç±»çš„å®ä¾‹ï¼Œå‡½æ•°ï¼ˆä½†ä¸åŒ…æ‹¬å‡½æ•°ä¸­å¼•ç”¨çš„å¤–éƒ¨å¯¹è±¡ï¼Œå¦‚æ–‡ä»¶å¯¹è±¡ã€æ•°æ®åº“è¿æ¥ç­‰ï¼‰ï¼‰å’Œååºåˆ—åŒ–ï¼‰å¦‚ä¸‹å†…å®¹ï¼š`square` å‡½æ•°ï¼ˆä¼ é€’ç»™å­è¿›ç¨‹ï¼‰ã€‚`numbers` åˆ—è¡¨ï¼ˆä¼ é€’ç»™å­è¿›ç¨‹ï¼‰ã€‚`results` åˆ—è¡¨ï¼ˆä»å­è¿›ç¨‹è¿”å›ç»™ä¸»è¿›ç¨‹ï¼‰ã€‚æ¯”å¦‚è¯´å°†`square`å‡½æ•°æ”¹ä¸ºï¼š

```python
def square(number):
    file = open("test.txt", "w")
    file.write(f"Processing {number}\n")
    file.close()
    return number â€‹** 2
```


* **3ã€è£…é¥°å™¨**

https://liaoxuefeng.com/books/python/functional/decorator/index.html


## å‚è€ƒ
1ã€https://docs.python.org/zh-cn/3.13/library/concurrent.futures.html
2ã€https://docs.python.org/zh-cn/3.13/library/threading.html
3ã€https://zh.wikipedia.org/zh-cn/%E5%85%A8%E5%B1%80%E8%A7%A3%E9%87%8A%E5%99%A8%E9%94%81
4ã€https://zh.wikipedia.org/wiki/CPU%E5%AF%86%E9%9B%86%E5%9E%8B
5ã€https://docs.python.org/zh-cn/3.13/library/multiprocessing.html
6ã€https://docs.python.org/zh-cn/3.12/library/pickle.html