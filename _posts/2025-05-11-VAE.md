---
layout: mypost
title: æ·±å…¥æµ…å‡ºäº†è§£ç”Ÿæˆæ¨¡å‹-2ï¼šVAEæ¨¡å‹åŸç†ä»¥åŠä»£ç å®æˆ˜
categories: ç”Ÿæˆæ¨¡å‹
extMath: true
images: true
address: changsha
show_footer_image: true
tags: [ç”Ÿæˆæ¨¡å‹, VAE]
description: æ—¥å¸¸ä½¿ç”¨æ¯”è¾ƒå¤šçš„ç”Ÿæˆæ¨¡å‹æ¯”å¦‚GPT/Qwenç­‰è¿™äº›å¤§å¤šéƒ½æ˜¯â€œæ–‡ç”Ÿæ–‡â€æ¨¡å‹ï¼ˆå½“ç„¶GPTæœ‰è‡ªå·±çš„å¤§ä¸€ç»Ÿæ¨¡å‹å¯ä»¥â€œæ–‡ç”Ÿå›¾â€ï¼‰ä½†æ˜¯ç½‘ä¸Šæµè¡Œå¾ˆå¤šAIç”Ÿæˆå›¾åƒï¼Œè€Œè¿™äº›ç”Ÿæˆå›¾åƒæ¨¡å‹å¤§å¤šéƒ½ç¦»ä¸å¼€ä¸‹é¢ä¸‰ç§æ¨¡å‹ï¼š1ã€GANï¼›2ã€VAEï¼›3ã€Diffusion Modelã€‚å› æ­¤æœ¬æ–‡é€šè¿‡ä»‹ç»è¿™ä¸‰ä¸ªæ¨¡å‹ä½œä¸ºç”Ÿæˆæ¨¡å‹çš„å…¥é—¨ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»GANæ¨¡å‹
---

å‰æ–‡å·²ç»ä»‹ç»äº†GANçš„åŸºæœ¬åŸç†ä»¥åŠä»£ç æ“ä½œï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»VAEå…¶åŸºæœ¬åŸç†ä»¥åŠä»£ç å®æˆ˜

## VAE or AE
ä»‹ç»VAEä¹‹å‰äº†è§£ä¸¤ä¸ªæ¦‚å¿µï¼šAEï¼ˆAutoEncoderï¼Œè‡ªç¼–ç å™¨ï¼‰å’ŒVAEï¼ˆVariational Autoencoderï¼Œå˜è‡ªç¼–ç å™¨ï¼‰ã€‚**AE**ï¼šè‡ªç¼–ç å™¨æ˜¯ä¸€ç§æ— ç›‘ç£å­¦ä¹ ç¥ç»ç½‘ç»œï¼Œæ—¨åœ¨é€šè¿‡å°†è¾“å…¥æ•°æ®å‹ç¼©åˆ°ä¸€ä¸ªä½ç»´è¡¨ç¤ºï¼ˆç¼–ç ï¼‰ï¼Œç„¶åä»è¯¥è¡¨ç¤ºé‡å»ºè¾“å…¥æ•°æ®ï¼ˆè§£ç ï¼‰ï¼Œæ¥å­¦ä¹ æ•°æ®çš„ç‰¹å¾è¡¨ç¤ºã€‚**VAE**ï¼šå˜åˆ†è‡ªç¼–ç å™¨æ˜¯è‡ªç¼–ç å™¨çš„æ‰©å±•ï¼Œç»“åˆäº†æ¦‚ç‡æ¨¡å‹å’Œæ·±åº¦å­¦ä¹ ï¼Œé€šè¿‡å¼•å…¥å˜åˆ†æ¨ç†ä½¿æ½œåœ¨ç©ºé—´å…·æœ‰æ¦‚ç‡åˆ†å¸ƒç‰¹æ€§ï¼Œé€‚åˆç”Ÿæˆä»»åŠ¡ã€‚
**AE**çš„æ•°å­¦æè¿°å¯¹äºè¾“å…¥ $x$é€šè¿‡ç¼–ç å™¨å°†è¾“å…¥æ˜ å°„åˆ° **ä½çº¬ç©ºé—´** $z=f(x)$è€Œåé€šè¿‡è§£ç å™¨å¾—åˆ°è¾“å‡ºï¼š$\hat{x}=g(x)$
**VAE**çš„æ•°å­¦æè¿°å¯¹äºè¾“å…¥ $x$é€šè¿‡ç¼–ç å™¨å°†è¾“å…¥æ˜ å°„æˆ **æ¦‚ç‡åˆ†å¸ƒ** $q(z|x)$ï¼Œå‡è®¾ä¸ºé«˜æ–¯åˆ†å¸ƒï¼Œè¾“å‡º ğœ‡å’Œ ğœï¼Œä» $q(z|x)$é‡‡æ · $z$è€Œåé€šè¿‡ $z=\mu+ \sigma+ \epsilon$ å…¶ä¸­ $\epsilon \in N(0,1)$ï¼Œè€Œåé€šè¿‡é‡‡æ ·å¾—åˆ°çš„$z$é‡æ–°æ„å»ºè¾“å…¥ï¼Œç”Ÿæˆ$p(x|z)$
å‰è€…ä¸é€‚åˆå¯¹äºå›¾ç‰‡è¿›è¡Œç”Ÿæˆè€Œåè€…åˆ™æ˜¯æ›´åŠ é€‚åˆå›¾åƒç”Ÿæˆï¼Œè¿™æ˜¯å› ä¸ºAEå°†è¾“å…¥æ˜ å°„åˆ°ä¸€ä¸ªä½çº¬ç©ºé—´zè¿™ä¸ªä½çº¬ç©ºé—´å¹¶æ²¡æœ‰æ˜ç¡®çš„ç»“æ„ï¼Œè¿›è€Œå°±å¯èƒ½ä¸é€‚åˆå»ç”Ÿæˆæ–°çš„æ•°æ®ï¼Œè€ŒVAEä¹‹æ‰€ä»¥å¯ä»¥ç”¨äºç”Ÿæˆæ–°çš„æ•°æ®æ˜¯ï¼Œæ¯”å¦‚è¯´å¯¹äºå›¾åƒæ•°æ®ï¼ˆæ¯”å¦‚è¯´ï¼šçŒ«ï¼‰å¦‚æœçŸ¥é“å…¶åˆ†å¸ƒç‰¹å¾ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡åˆ†å¸ƒç‰¹å¾å»æ„å»ºä¸€ä¸ªæ–°çš„å›¾åƒ

![](https://s2.loli.net/2025/05/13/Ji5sAMmGehLjdf9.png)

## VAEï¼ˆVariational Autoencoderï¼‰
ä¸Šé¢ç®€å•ä»‹ç»äº†VAEæ•°å­¦æè¿°è¿™é‡Œé‡æ–°å†æè¿°ä¸€ä¸‹å…¶æ•°å­¦æè¿°ï¼ˆæ¶‰åŠåˆ°æ¯”è¾ƒå¤šè´å¶æ–¯ç»Ÿè®¡ç›¸å…³å†…å®¹ï¼‰ï¼š
### 1.åŸºæœ¬æ¡†æ¶
VAE æ˜¯ä¸€ç§ç”Ÿæˆæ¨¡å‹ï¼Œ**ç›®æ ‡æ˜¯å­¦ä¹ æ•°æ®çš„æ¦‚ç‡åˆ†å¸ƒ p(x)ï¼Œè®©æ¨¡å‹èƒ½ç”Ÿæˆç±»ä¼¼çœŸå®æ•°æ®çš„æ–°æ ·æœ¬**ï¼Œæƒ³è±¡æˆ‘ä»¬è¦åˆ¶ä½œå„ç§è›‹ç³•ï¼ˆæ•°æ® $x$ï¼‰ï¼Œä½†ä¸çŸ¥é“è›‹ç³•çš„â€œç§˜æ–¹â€ï¼ˆæ½œåœ¨å˜é‡ $z$ï¼‰ã€‚å‡è®¾æ‰€æœ‰è›‹ç³•ç»„æˆæ•°æ®é›† $X = {x_1, \dots, x_n}$ï¼Œæ¯ç§è›‹ç³•ï¼ˆå¦‚å·§å…‹åŠ›è›‹ç³•æˆ–æ°´æœè›‹ç³•ï¼‰èƒŒåæœ‰ç‹¬ç‰¹çš„ç§˜æ–¹ã€‚VAE é€šè¿‡å­¦ä¹ ç§˜æ–¹çš„åˆ†å¸ƒå’Œç”Ÿæˆè¿‡ç¨‹ï¼Œåˆ¶é€ å‡ºé€¼çœŸçš„è›‹ç³•ã€‚
**ç§˜æ–¹**ï¼šVAE å‡è®¾ç§˜æ–¹ $z$ æœä»æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼Œå³å…ˆéªŒåˆ†å¸ƒ $p(z) = \mathcal{N}(0, I)$ã€‚è¿™æ„å‘³ç€å¤§å¤šæ•°ç§˜æ–¹æ˜¯â€œæ™®é€šâ€çš„ï¼Œå›´ç»•å¹³å‡å€¼åˆ†å¸ƒã€‚
**ç”Ÿæˆè›‹ç³•ï¼ˆè§£ç å™¨ï¼‰**ï¼šç»™å®šç§˜æ–¹ $z$ï¼ŒVAE ä½¿ç”¨ä¸€ä¸ªâ€œè›‹ç³•æœºâ€ï¼ˆè§£ç å™¨ï¼Œå‚æ•° $\theta$ï¼‰ç”Ÿæˆè›‹ç³• $x$ã€‚è§£ç å™¨å»ºæ¨¡æ¡ä»¶åˆ†å¸ƒ $p_\theta(x|z) = \mathcal{N}(x; \mu_\theta(z), \sigma_\theta^2(z))$ï¼Œè¡¨ç¤ºä» $z$ ç”Ÿæˆ $x$ çš„æ¦‚ç‡ã€‚
**çŒœæµ‹ç§˜æ–¹ï¼ˆç¼–ç å™¨ï¼‰**ï¼šç›´æ¥ä»è›‹ç³• $x$ åæ¨ç§˜æ–¹ï¼ˆåéªŒåˆ†å¸ƒ $p_\theta(z|x)=\frac{p_\theta(x,z)}{p_\theta(x)}=\frac{p_\theta(x|z)p(z)}{p_\theta(x)}$ï¼‰å¾ˆå›°éš¾ï¼ˆå› ä¸ºæˆ‘çš„å˜é‡æ˜¯ä¸€ä¸ªé«˜ç»´çš„ï¼Œæ¢å¥è¯´æ³•å°±æ˜¯æˆ‘çš„è›‹ç³•ä»–æœ‰åƒå¥‡ç™¾æ€ªç§ç»„åˆï¼‰ã€‚æ—¢ç„¶å¦‚æ­¤å°±åªéœ€è¦å°†åˆ¶é€ è›‹ç³•çš„ç»„åˆåˆ†è§£ï¼Œåˆ†è§£æˆä½ç»´çš„å˜é‡ $z$ï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„ **ç§˜æ–¹**ï¼‰ç„¶åæˆ‘å»è®¡ç®—ä¸‹é¢ä¸€ä¸ªè”åˆåˆ†å¸ƒï¼š

$$
p_\theta(x) =\int p_\theta(x|z)p(z)dz
$$

ä¸è¿‡å°±ç®—ä¸Šé¢ç§¯åˆ†ä¼šå­˜åœ¨å›°éš¾å³ä½¿ä½ å°†è›‹ç³•åˆ†è§£æˆä¸åŒçš„ *æ½œåœ¨å˜é‡* ä½†æ˜¯è¿™äº›æ½œåœ¨å˜é‡ç§ç±»ä¹Ÿæ˜¯å¾ˆå¤šçš„ï¼ˆè›‹ç³•å¥¶æ²¹ã€åŠ ä¸åŠ å·§å…‹åŠ›ç­‰ç­‰ï¼‰é‚£ä¹ˆä¸Šé¢çš„è”åˆåˆ†å¸ƒå°±ä¼šå˜æˆï¼š

$$
\int p_\theta(x|z)p(z)dz = \int_{z_1} ... \int_{z_d}p_\theta(x|z)p(z)d_{z_1}...d_{z_d}
$$

è¿™ç§é«˜ç»´ç§¯åˆ†æ²¡æœ‰è§£æè§£ï¼Œæ•°å€¼ç§¯åˆ†è®¡ç®—å¤æ‚åº¦éšç»´åº¦æŒ‡æ•°å¢é•¿ï¼Œå› æ­¤åœ¨VAE å¼•å…¥ä¸€ä¸ªâ€œçŒœæµ‹æœºâ€ï¼ˆç¼–ç å™¨ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œå‚æ•° $\phi$ï¼‰ï¼Œç”¨å˜åˆ†åˆ†å¸ƒï¼š

$$
q_\phi(z|x) = \mathcal{N}(z; \mu_\phi(x), \text{diag}(\sigma_\phi^2(x)))
$$ 

è¿‘ä¼¼åéªŒåˆ†å¸ƒï¼Œä¼°è®¡å¯èƒ½çš„ç§˜æ–¹ä¹Ÿå°±æ˜¯å»ä¼°ç®—æˆ‘ä»¬çš„ $p_\theta(z|x)$
å¤§è‡´æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼šVAEçš„ä¸»è¦çš„ä»»åŠ¡å°±æ˜¯ï¼Œæœ€å¼€å§‹çš„æ•°æ®é›†é‡Œé¢ï¼Œæˆ‘å¸Œæœ›é€šè¿‡å¯¹è¿™ä¸ªæ•°æ®è®°å¾—æ½œåœ¨åˆ†å¸ƒè¿›è¡Œå­¦ä¹ ï¼Œå¦‚æœæˆ‘æ¨¡å‹å­¦ä¼šäº†å„ç±»æ•°æ®çš„åˆ†å¸ƒï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡è¿™äº›åˆ†å¸ƒå»è¿›ä¸€æ­¥ç”Ÿæˆæ–°çš„æ•°æ®ã€‚

### 2.æ¨¡å‹å‚æ•°æ±‚è§£
äº†è§£æ¨¡å‹åŸºæœ¬æ¡†æ¶ä¹‹åå°±éœ€è¦å¯¹æ•´ä¸ªæ¨¡å‹çš„å‚æ•°è¿›è¡Œæ±‚è§£

## 3.ä»£ç æ“ä½œ


### å®é™…ç”Ÿæˆæ•ˆæœ
> VAEæµ‹è¯•çš„ä¸»è¦æ˜¯ç”Ÿæˆæ•ˆæœï¼Œè€ŒVA-VAEåˆ™æ˜¯æµ‹è¯•é‡æ„æ•ˆæœ

**VAE**åœ¨MNISTæ•°æ®é›†ä¸Šè¡¨ç°

| å›ºå®šè¾“å…¥ | é‡æ„å›¾åƒ | éšæœºç”Ÿæˆ |
|:--------:|:---------:|:--------:|
| ![](https://s2.loli.net/2025/05/14/ABJDCTjW46Odx3g.gif) | ![](https://s2.loli.net/2025/05/14/fQmMFOXRNovIubA.gif) | ![](https://s2.loli.net/2025/05/14/28Tln5qcap6HvPf.gif) |


**VQ-VAE**åœ¨CIFAR10æ•°æ®é›†ä¸Šé‡æ„å›¾åƒçš„è¡¨ç°

| é‡æ„å›¾åƒ | PixelCNNç”Ÿæˆå›¾åƒ |
|:------:|:----------------:|
|![](https://s2.loli.net/2025/05/14/38zIQHaL9Vukret.gif)| |

## æ€»ç»“

## å‚è€ƒ
1ã€https://github.com/hkproj/vae-from-scratch-notes/blob/main/VAE.pdf
2ã€https://mbernste.github.io/posts/vae/
3ã€https://arxiv.org/pdf/1906.02691
