<!DOCTYPE html>
<html lang="zh-CN">
{% include head.html -%}
<body>
{% include header.html -%}
<div class="page page-post">
  <h1 class="title" id="{{ page.title }}">{{ page.title }}</h1>
  {% if page.date %}
  <div class="subtitle">
    <span>{{site.author}} 于 
      {{ page.date | date: "%Y-%m-%d" }} 
      {page.adress}发布
      天气:<span id="weather-info"> 加载天气...</span>
    </span>
    {%- if site.extCount %}
      <span>浏览量</span>
      <span id="busuanzi_value_page_pv"></span>
    {% endif %}
  </div>
  {% endif %}
  
  <div class="post">
    {{ content }}
  </div>

  <!-- 添加分享按钮 -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <div class="share-buttons">
    <!-- 微博分享 -->
    <button class="share-button" onclick="shareOnSocial('weibo')">
      <i class="fab fa-weibo"></i>
    </button>
  
    <!-- QQ 分享 -->
    <button class="share-button" onclick="shareOnSocial('qq')">
      <i class="fab fa-qq"></i>
    </button>
  
    <!-- 微信分享 -->
    <button class="share-button" onclick="shareOnWeChat()">
      <i class="fab fa-weixin"></i>
    </button>
  </div>


  <!-- 添加 Gitalk 评论 -->
  <div id="gitalk-container"></div>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <!-- 引入 md5 库 -->
  <script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script>
  <!-- 引入 Gitalk 脚本 -->
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <script>
    var gitalk = new Gitalk({
      clientID: 'Ov23liAg6ZGUK44WreDc', // GitHub OAuth App 的 Client ID
      clientSecret: '48a53ddcc5b26907abe4c3131c59a6fdb566a0ed', // GitHub OAuth App 的 Client Secret
      repo: 'discuss-store', // 用于存储评论的 GitHub 仓库
      owner: 'Big-Yellow-J', // GitHub 用户名
      admin: ['Big-Yellow-J'], // 管理员用户名
      // id: '{{ page.id }}', // 当前页面的唯一标识符
      id: '{{ page.title }}', // 对标题进行哈希处理
      distractionFreeMode: false // 专注模式
    });
    gitalk.render('gitalk-container');
  </script>


  <!-- 加载天气 -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 获取文章的发布日期（比如 2025-01-17）
      const publishDate = "{{ page.date | date: '%Y-%m-%d' }}";
      const address = "{{ page.address }}"; // 获取文章中的地址
      const weatherElement = document.getElementById('weather-info');
      
      // 使用 OpenStreetMap Nominatim API 获取地址的经纬度
      const geocodeUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`;

      fetch(geocodeUrl)
        .then(response => response.json())
        .then(data => {
          if (data && data[0]) {
            const latitude = data[0].lat;
            const longitude = data[0].lon;

            // 获取指定日期的天气数据
            const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&daily=temperature_2m_max,temperature_2m_min&start_date=${publishDate}&end_date=${publishDate}&timezone=Asia%2FShanghai`;

            fetch(weatherUrl)
              .then(weatherResponse => weatherResponse.json())
              .then(weatherData => {
                if (weatherData.daily) {
                  const maxTemp = weatherData.daily.temperature_2m_max[0];  // 获取当天的最高温度
                  const minTemp = weatherData.daily.temperature_2m_min[0];  // 获取当天的最低温度
                  const weatherText = `当天天气: 最高温度 ${maxTemp}°C, 最低温度 ${minTemp}°C`;
                  weatherElement.innerText = weatherText;
                } else {
                  weatherElement.innerText = '无法获取历史天气数据';
                }
              })
              .catch(error => {
                weatherElement.innerText = '天气信息加载失败';
              });
          } else {
            weatherElement.innerText = '地址无效';
          }
        })
        .catch(error => {
          weatherElement.innerText = '地理编码失败';
        });
    });
  </script>
  {% if site.extAdsense -%}
  <div class="adsense" style="overflow: hidden;">
    {% include ext-adsense.html -%}
  </div>
  {% endif %}
</div>
{% include footer.html -%}
{% include script.html -%}
</body>
</html>