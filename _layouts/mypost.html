<!DOCTYPE html>
<html lang="zh-CN">
{% include head.html -%}
<body>
{% include header.html -%}
<div class="page page-post">
  <h1 class="title" id="{{ page.title }}">{{ page.title }}</h1>
  {% if page.date %}
  <div class="subtitle">
    <span>{{site.author}} äº 
      {{ page.date | date: "%Y-%m-%d" }} 
      åœ¨ {{ page.address }} å‘å¸ƒ
      å¤©æ°”:<span id="weather-info"> åŠ è½½å¤©æ°”...</span>
    </span>
    {%- if site.extCount %}
      <span>æµè§ˆé‡</span>
      <span id="busuanzi_value_page_pv"></span>
    {% endif %}
  </div>
  {% endif %}
  
  <div class="post">
    {{ content }}
  </div>

  <!-- æ·»åŠ åˆ†äº«æŒ‰é’® -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <div class="share-buttons">
    <!-- å¾®åšåˆ†äº« -->
    <button class="share-button" onclick="shareOnSocial('weibo')">
      <i class="fab fa-weibo"></i>
    </button>
  
    <!-- QQ åˆ†äº« -->
    <button class="share-button" onclick="shareOnSocial('qq')">
      <i class="fab fa-qq"></i>
    </button>
  
    <!-- å¾®ä¿¡åˆ†äº« -->
    <button class="share-button" onclick="shareOnWeChat()">
      <i class="fab fa-weixin"></i>
    </button>
  </div>

  <!-- æ·»åŠ  Gitalk è¯„è®º -->
  <div id="gitalk-container"></div>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <!-- å¼•å…¥ md5 åº“ -->
  <script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script>
  <!-- å¼•å…¥ Gitalk è„šæœ¬ -->
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <script>
    var gitalk = new Gitalk({
      clientID: 'Ov23liAg6ZGUK44WreDc', // GitHub OAuth App çš„ Client ID
      clientSecret: '48a53ddcc5b26907abe4c3131c59a6fdb566a0ed', // GitHub OAuth App çš„ Client Secret
      repo: 'discuss-store', // ç”¨äºå­˜å‚¨è¯„è®ºçš„ GitHub ä»“åº“
      owner: 'Big-Yellow-J', // GitHub ç”¨æˆ·å
      admin: ['Big-Yellow-J'], // ç®¡ç†å‘˜ç”¨æˆ·å
      id: md5('{{ page.title }}'), // å¯¹æ ‡é¢˜è¿›è¡Œå“ˆå¸Œå¤„ç†
      distractionFreeMode: false // ä¸“æ³¨æ¨¡å¼
    });
    gitalk.render('gitalk-container');
  </script>

  <!-- åŠ è½½å¤©æ°” -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // è·å–æ–‡ç« çš„å‘å¸ƒæ—¥æœŸï¼ˆæ¯”å¦‚ 2025-01-17ï¼‰
      const publishDate = "{{ page.date | date: '%Y-%m-%d' }}";
      const address = "{{ page.address }}"; // è·å–æ–‡ç« ä¸­çš„åœ°å€
      const weatherElement = document.getElementById('weather-info');
      
      // ä½¿ç”¨ OpenStreetMap Nominatim API è·å–åœ°å€çš„ç»çº¬åº¦
      const geocodeUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`;

      fetch(geocodeUrl)
        .then(response => response.json())
        .then(data => {
          if (data && data[0]) {
            // ç»´åº¦ ç»åº¦
            const latitude = data[0].lat;
            const longitude = data[0].lon; 
            const weatherCodeMapping = {
              0: 'â˜€ï¸',  // Clear sky
              1: 'ğŸŒ¤ï¸',  // Mainly clear
              2: 'â›…',   // Partly cloudy
              3: 'â˜ï¸',   // Cloudy
              45: 'ğŸŒ«ï¸',  // Fog
              48: 'ğŸŒ«ï¸',  // Depositing rime fog
              51: 'ğŸŒ§ï¸',  // Light drizzle
              53: 'ğŸŒ§ï¸',  // Moderate drizzle
              55: 'ğŸŒ§ï¸',  // Dense drizzle
              56: 'â„ï¸ğŸŒ§ï¸', // Light freezing drizzle
              57: 'â„ï¸ğŸŒ§ï¸', // Dense freezing drizzle
              61: 'ğŸŒ§ï¸',  // Light rain
              63: 'ğŸŒ§ï¸',  // Moderate rain
              65: 'ğŸŒ§ï¸',  // Heavy rain
              66: 'â„ï¸ğŸŒ§ï¸', // Light freezing rain
              67: 'â„ï¸ğŸŒ§ï¸', // Heavy freezing rain
              71: 'â„ï¸',   // Light snow
              73: 'â„ï¸',   // Moderate snow
              75: 'â„ï¸',   // Heavy snow
              77: 'â„ï¸',   // Snow grains
              80: 'ğŸŒ§ï¸',  // Showers of rain
              81: 'ğŸŒ§ï¸',  // Heavy showers of rain
              82: 'ğŸŒ§ï¸',  // Violent showers of rain
              85: 'â„ï¸ğŸŒ§ï¸', // Showers of snow
              86: 'â„ï¸ğŸŒ§ï¸', // Heavy showers of snow
              95: 'âš¡',   // Thunderstorm
              96: 'âš¡â„ï¸', // Thunderstorm with light hail
              99: 'âš¡â„ï¸'  // Thunderstorm with heavy hail
            };

            // è·å–æŒ‡å®šæ—¥æœŸçš„å¤©æ°”æ•°æ®
            // const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&daily=weathercode,temperature_2m_max,temperature_2m_min&start_date=${publishDate}&end_date=${publishDate}&timezone=Asia%2FShanghai`;
            const weatherUrl = `https://rough-queen-833d.workers.dev/v1/forecast?latitude=${latitude}&longitude=${longitude}&daily=weathercode,temperature_2m_max,temperature_2m_min&start_date=${publishDate}&end_date=${publishDate}&timezone=Asia%2FShanghai`;

            fetch(weatherUrl)
              .then(weatherResponse => weatherResponse.json())
              .then(weatherData => {
                if (weatherData.daily) {
                  const weatherCode = weatherData.daily.weathercode[0];
                  const maxTemp = weatherData.daily.temperature_2m_max[0];  // è·å–å½“å¤©çš„æœ€é«˜æ¸©åº¦
                  const minTemp = weatherData.daily.temperature_2m_min[0];  // è·å–å½“å¤©çš„æœ€ä½æ¸©åº¦
                  const weatherText = `${weatherCodeMapping[weatherCode] || 'â“'}`;
                  weatherElement.innerText = weatherText;
                } else {
                  weatherElement.innerText = 'æ— æ³•è·å–å†å²å¤©æ°”æ•°æ®';
                }
              })
              .catch(error => {
                weatherElement.innerText = 'å¤©æ°”ä¿¡æ¯åŠ è½½å¤±è´¥';
              });
          } else {
            weatherElement.innerText = 'åœ°å€æ— æ•ˆ';
          }
        })
        .catch(error => {
          console.error('åœ°ç†ç¼–ç è¯·æ±‚é”™è¯¯:', error);
          weatherElement.innerText = 'åœ°ç†ç¼–ç å¤±è´¥';
        });
    });
  </script>
  {% if site.extAdsense -%}
  <div class="adsense" style="overflow: hidden;">
    {% include ext-adsense.html -%}
  </div>
  {% endif %}
</div>
{% include footer.html -%}
{% include script.html -%}
</body>
</html>