---
layout: mypost
title: æ¨¡å‹æ¨ç†æ¡†æ¶â€”â€”SGLangã€vllmï¼ˆ1ï¼‰
categories: é‡åŒ–éƒ¨ç½²
address: æ­¦æ±‰ğŸ¯
extMath: true
show_footer_image: true
tags:
- æ¨¡å‹æ¨ç†
- æ¨¡å‹éƒ¨ç½²
description: SGLangæ˜¯é¢å‘å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰å’Œè§†è§‰è¯­è¨€æ¨¡å‹ï¼ˆVLMï¼‰çš„é«˜æ€§èƒ½æ¨ç†æ¡†æ¶ï¼Œæ ¸å¿ƒæŠ€æœ¯åŒ…æ‹¬RadixAttentionä¸Compressed
  FSMsã€‚RadixAttentioné€šè¿‡radix treeå­˜å‚¨KV-cacheæ˜ å°„ï¼Œåˆ©ç”¨å‰ç¼€åŒ¹é…å¿«é€Ÿå¤ç”¨ç¼“å­˜ï¼Œå¹¶é‡‡ç”¨LRUç­–ç•¥ä¼˜åŒ–ç¼“å­˜ç®¡ç†ï¼Œå‡å°‘è®¡ç®—å¼€é”€ï¼›Compressed
  FSMsé’ˆå¯¹ç”¨æˆ·è¾“å‡ºçš„â€œå‰ç¼€è¯â€è¿›è¡Œå‹ç¼©ï¼Œç»“åˆInterleaved-Basedæ–¹æ³•åˆ†å‰²ç»“æ„åŒ–è¾“å‡ºä¸ºå›ºå®šä¸ç”Ÿæˆç‰‡æ®µï¼Œäº¤é”™æ‰§è¡Œä»¥æå‡æ¨ç†é€Ÿåº¦ï¼Œå®ç°é«˜æ•ˆå¯æ§çš„æ¨¡å‹äº¤äº’ã€‚
---

SGLang[^2] æ˜¯ä¸€æ¬¾é¢å‘å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰å’Œè§†è§‰è¯­è¨€æ¨¡å‹ï¼ˆVLMï¼‰çš„é«˜æ€§èƒ½æ¨ç†æ¡†æ¶ï¼Œé€šè¿‡ç²¾å¿ƒè®¾è®¡çš„åç«¯è¿è¡Œæ—¶ä¸å‰ç«¯è¯­è¨€ååŒå·¥ä½œï¼Œä½¿æ¨¡å‹äº¤äº’æ›´åŠ é«˜æ•ˆä¸”å¯æ§ã€‚æŒ‰ç…§è®ºæ–‡é‡Œé¢çš„æè¿°å¯¹äºSGLangä¸­åˆ†ä¸ºå‰åç«¯ï¼Œå¤§è‡´ç»“æ„å¦‚ä¸‹ï¼š
![](https://s2.loli.net/2025/11/11/1SEGLgmsKMQcDof.webp)
> å’Œvllmä¸€æ ·SGLangéƒ½æ˜¯ä¸€ä¸ªåŠ é€Ÿæ¨ç†æ¡†æ¶ï¼Œä¸¤è€…å¯¹æ¯”æ•ˆæœ[^1][^3]

## Vllmæ ¸å¿ƒæŠ€æœ¯åˆ†æ

## SGLangæ ¸å¿ƒæŠ€æœ¯åˆ†æ
### RadixAttention
ä¸ºäº†èŠ‚çº¦KV-cacheæ˜¾å­˜å ç”¨ä»¥åŠåŠ é€Ÿæ¨ç†è¿‡ç¨‹åœ¨SGLangä¸­å¼•å…¥äº†RadixAttentionï¼Œå…¶ä¸»è¦æ€è·¯å¦‚ä¸‹ï¼š
**æ™ºèƒ½ç¼“å­˜ä¿ç•™**ï¼šæ¯æ¬¡è¯·æ±‚å®Œæˆåï¼Œå½“å‰è¯·æ±‚çš„ KV Cache ä¸ä¼šç«‹å³é‡Šæ”¾ï¼Œè€Œæ˜¯é€šè¿‡ RadixAttention ç®—æ³•ç²¾å¿ƒä¿ç•™åœ¨ GPU æ˜¾å­˜ä¸­ã€‚åŒæ—¶ï¼ŒRadixAttention å°†åºåˆ— token ä¸ KV Cache ä¹‹é—´çš„æ˜ å°„å…³ç³»å­˜å‚¨åœ¨ä¸“ç”¨çš„ radix tree æ•°æ®ç»“æ„ä¸­ã€‚
**é«˜æ•ˆç¼“å­˜å‘½ä¸­**ï¼šæ–°è¯·æ±‚åˆ°è¾¾æ—¶ï¼ŒSGLang è°ƒåº¦å™¨åˆ©ç”¨ radix tree æ‰§è¡Œå‰ç¼€åŒ¹é…ç®—æ³•ï¼Œå¿«é€Ÿåˆ¤æ–­æ–°è¯·æ±‚æ˜¯å¦èƒ½å¤Ÿå¤ç”¨å·²æœ‰ç¼“å­˜ã€‚ä¸€æ—¦å‘½ä¸­ï¼Œè°ƒåº¦å™¨ç«‹å³å¤ç”¨ç°æœ‰ KV Cache å¤„ç†è¯¥è¯·æ±‚ï¼Œæ˜¾è‘—å‡å°‘è®¡ç®—å¼€é”€ã€‚
**æ™ºèƒ½ç¼“å­˜ç®¡ç†**ï¼šè€ƒè™‘åˆ° GPU æ˜¾å­˜èµ„æºæœ‰é™ï¼Œç¼“å­˜ä¸­çš„ KV Cache éœ€è¦åˆç†ç®¡ç†ã€‚RadixAttention é‡‡ç”¨ç»å…¸çš„ LRUï¼ˆLeast Recently Usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç­–ç•¥è¿›è¡Œç¼“å­˜æ·˜æ±°ï¼Œè¿™ä¸€æœºåˆ¶ä¸æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†ä¸­çš„é¡µé¢ç½®æ¢ç®—æ³•ç›¸ä¼¼ï¼Œç¡®ä¿æœ€æœ‰ä»·å€¼çš„ç¼“å­˜å¾—åˆ°ä¿ç•™ã€‚
![](https://s2.loli.net/2025/11/11/ZbqOiuQvAXceMED.webp)
ä¸Šå›¾ä¸­ï¼šç»¿è‰²ä»£è¡¨æ–°æ·»åŠ çš„èŠ‚ç‚¹ã€è“è‰²ä»£è¡¨å½“å‰æ—¶é—´ç‚¹è®¿é—®çš„ç¼“å­˜èŠ‚ç‚¹ã€çº¢è‰²ä»£è¡¨æ·˜æ±°çš„èŠ‚ç‚¹ã€‚å…¶å®å°±æ˜¯æ ¹æ®ç”¨æˆ·æå‡ºé—®é¢˜å»åˆ°radix treeä¸­æ‰¾åˆ°å¯¹åº”çš„ç¼“å­˜ç„¶ååŠ å…¥åˆ°è®¡ç®—ä¸­ã€‚
### Compressed FSMs
å¯¹äºCompressed FSMsè¿‡ç¨‹ä¸»è¦æ˜¯æ ¹æ®ï¼šä¸€èˆ¬è€Œè¨€ç”¨æˆ·åœ¨è¾“å‡ºå†…å®¹è¿‡ç¨‹ä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ªâ€œå‰ç¼€è¯â€ä½†æ˜¯æ ¹æ®LLMç”Ÿæˆè¿‡ç¨‹è¿™ä¸ªâ€œå‰ç¼€è¯â€å¯¹äºæ¨¡å‹çš„è¾“å‡ºå½±å“ä¸å¤§ï¼Œå› æ­¤å¯ä»¥å°†â€œå‰ç¼€è¯â€è¿›è¡Œå‹ç¼©ï¼Œä»è€Œæé«˜æ¨¡å‹æ¨ç†é€Ÿåº¦ã€‚
![](https://s2.loli.net/2025/11/11/gRd3v7EjWAsLJib.webp)
> åœ¨LLMç”Ÿæˆè¿‡ç¨‹ä¸­[^5]å¾€å¾€æ˜¯å¾—åˆ° $i$ ä¹‹åç»§ç»­ä½¿ç”¨Aç„¶åå»ç”Ÿæˆåç»­çš„ $i+1$ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„FSMï¼ˆFinite State Machineï¼Œæœ‰é™çŠ¶æ€æœºï¼‰ï¼Œäº‰å¯¹è¿™ç§é—®é¢˜æå‡ºæ”¹è¿› Interleaved-Basedæ–¹æ³•[^6]å…·ä½“çš„åŸç†ä¸ºï¼šæŠŠæ•´ä¸ªç»“æ„åŒ–è¾“å‡ºï¼ˆæ¯”å¦‚ä¸€ä¸ª JSON å¯¹è±¡ï¼‰åˆ†å‰²æˆè‹¥å¹²æ®µï¼ˆchunksï¼‰â€” è¿™äº›æ®µæœ‰çš„â€œå›ºå®šç‰‡æ®µâ€ï¼ˆprefillï¼å¡«å……ç‰‡æ®µï¼‰ã€æœ‰çš„â€œç”Ÿæˆç‰‡æ®µâ€ï¼ˆéœ€è¦æ¨¡å‹ç”Ÿæˆï¼å—æ§ç”Ÿæˆï¼‰ã€‚ç„¶åâ€œäº¤é”™ï¼ˆinterleaveï¼‰â€æ‰§è¡Œï¼šå€ŸåŠ© â€œprefill å¤š tokenä¸€æ¬¡èµ°â€ï¼‹â€œå—æ§ç”Ÿæˆå°‘é‡ tokensâ€ çš„æ··åˆæ¨¡å¼ï¼Œä»è€ŒåŠ å¿«æ•´ä½“ç”Ÿæˆ
> ![](https://s2.loli.net/2025/11/11/4HdmBSfvFnT2zj7.webp)
> æ¯”å¦‚è¯´éœ€è¦ç”Ÿæˆï¼š`{ "name": "<MODEL_GEN_1>", "age": <MODEL_GEN_2> }` é‚£ä¹ˆäº¤é”™ç”Ÿæˆè¿‡ç¨‹ä¸ºå…ˆå»å›ºå®šâ€œå‰ç¼€è¯â€ï¼ˆ`{ "name": "`ï¼‰ç”Ÿæˆ`<MODEL_GEN_1>`è€Œåå†å»å›ºå®šâ€œå‰ç¼€è¯â€ï¼ˆ`", "age":`ï¼‰ä¾æ¬¡ç±»æ¨ã€‚

å¯¹äºCompressed FSMs**å…·ä½“è¿‡ç¨‹æè¿°å¦‚ä¸‹**ï¼š
![](https://s2.loli.net/2025/11/11/CjBRlGuHg9XKfaT.webp)

## æ€»ç»“

## å‚è€ƒ
[^1]: [å¯¹æ¯”äº† vLLM å’Œ SGLang åœ¨ä¸¤å¼ è‹±ä¼Ÿè¾¾ GPU ä¸Šçš„è¡¨ç° - SGLang ç”¨æ•°æ®å¹¶è¡ŒåŠæ‰“å®ƒ](https://www.reddit.com/r/LocalLLaMA/comments/1jjl45h/compared_performance_of_vllm_vs_sglang_on_2/?tl=zh-hans)
[^2]: [https://arxiv.org/pdf/2312.07104](https://arxiv.org/pdf/2312.07104)
[^3]: [vLLMå’ŒSGLangçš„æ¯”è¾ƒï¼ˆæœ€æ–°ç‰ˆæœ¬ï¼‰](https://zhuanlan.zhihu.com/p/1909197327287182496)
[^4]: [https://zhuanlan.zhihu.com/p/30886364337](https://zhuanlan.zhihu.com/p/30886364337)
[^5]: [https://lmsys.org/blog/2024-02-05-compressed-fsm/](https://lmsys.org/blog/2024-02-05-compressed-fsm/)
[^6]: [guidance-Github](https://github.com/guidance-ai/guidance?tab=readme-ov-file#guidance-acceleration)