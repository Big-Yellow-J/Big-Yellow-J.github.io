<!-- MathJax 数学公式支持 -->
<style>
  /* 公式容器样式 */
  .has-jax {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none; /* 禁止公式被选中 */
    background-color: transparent !important;
    line-height: normal !important;
    word-break: normal !important;
    padding: 0 !important;
    margin: 0 !important;
  }

  .has-jax .MathJax {
    font-family: 'MathJax_Main-Regular', 'MathJax_Math-Regular', 'MathJax_Size1-Regular' !important;
    /* MathJax 字体资源的 url 配置 */
    src: url('https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Regular.woff') format('woff'),
         url('https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Math-Regular.woff') format('woff'),
         url('https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size1-Regular.woff') format('woff');
  }

  /* 公式内部元素样式 */
  .has-jax * {
    outline: 0;
  }
</style>

<!-- MathJax 配置 -->
<script type="text/x-mathjax-config">
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']], // 行内公式分隔符
      displayMath: [['$$', '$$'], ['\\[', '\\]']], // 独立公式分隔符
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'a'] // 跳过指定标签
    },
    chtml: {
      font: 'STIX-Web', // 使用 STIX 网络字体
      showProcessingMessages: false, // 隐藏处理消息
      messageStyle: 'none', // 不显示消息
      showMathMenu: false, // 隐藏右键菜单
    }
  };
</script>

<!-- 加载 MathJax 库 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/latest.js"></script>

<!-- 在 MathJax 完成渲染后，添加类名以便于 CSS 控制 -->
<script type="text/javascript">
  MathJax.startup.promise.then(() => {
    var all = document.querySelectorAll('script[type="math/tex"], script[type="math/tex; mode=display"]');
    for (var i = 0; i < all.length; i++) {
      all[i].parentNode.classList.add('has-jax');
    }
    MathJax.typeset();  // 强制重新渲染所有公式
  });
</script>
